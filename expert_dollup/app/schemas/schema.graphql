scalar JsonSchema

type DatasheetDefinitionPropertySchema {
  valueValidator: JsonSchema!
}

type DatasheetDefinitionPropertySchemaDict {
  name: String!
  schema: DatasheetDefinitionPropertySchema!
}

type DatasheetDefinition {
  id: ID!
  name: String!
  properties: [DatasheetDefinitionPropertySchemaDict!]!
  elementsDefinition(
    first: Int!
    after: String
  ): DatasheetDefinitionElementConnection
}

type DatasheetDefinitionEdge {
  node: DatasheetDefinition!
  cursor: String!
}

type DatasheetDefinitionConnection {
  edges: [DatasheetDefinitionEdge!]!
  pageInfo: PageInfo!
}

type DatasheetDefinitionElementEdge {
  node: DatasheetDefinitionElement!
  cursor: String!
}

type DatasheetDefinitionElementConnection {
  edges: [DatasheetDefinitionElementEdge!]!
  pageInfo: PageInfo!
}

type DatasheetDefinitionElementProperty {
  isReadonly: Boolean!
  value: String!
}

type DatasheetDefinitionElementPropertyDict {
  name: String!
  property: DatasheetDefinitionElementProperty!
}

type DatasheetDefinitionElement {
  id: ID!
  unitId: String!
  isCollection: Boolean!
  datasheetDefId: String!
  datasheetDefinition: DatasheetDefinition
  orderIndex: Int!
  name: String!
  defaultProperties: [DatasheetDefinitionElementPropertyDict!]!
  tags: [String!]!
  creationDateUtc: String!
}

type DatasheetElement {
  datasheetId: String!
  elementDefId: String!
  elementDefinition: DatasheetDefinitionElement!
  childElementReference: ID!
  properties: String!
  originalDatasheetId: String!
  creationDateUtc: String!
}

type DatasheetElementEdge {
  node: DatasheetElement!
  cursor: String!
}

type DatasheetElementConnection {
  edges: [DatasheetElementEdge!]!
  pageInfo: PageInfo!
}

type Datasheet {
  id: ID!
  name: String!
  isStaged: Boolean!
  datasheetDefId: String!
  fromDatasheetId: String
  elements(first: Int!, after: String): DatasheetElementConnection!
}

type DatasheetEdge {
  node: Datasheet!
  cursor: String!
}

type DatasheetConnection {
  edges: [DatasheetEdge!]!
  pageInfo: PageInfo!
}

type IntFieldConfig {
  unit: String!
}

type DecimalFieldConfig {
  unit: String!
  precision: Int!
}

type StringFieldConfig {
  transforms: [String!]!
}

type BoolFieldConfig {
  isCheckbox: Boolean!
}

type StaticChoiceOption {
  id: String!
  label: String!
  helpText: String!
}

type StaticChoiceFieldConfig {
  options: [StaticChoiceOption!]!
}

type CollapsibleContainerFieldConfig {
  isCollapsible: Boolean!
}

type StaticNumberFieldConfig {
  passToTranslation: Boolean!
  precision: Int!
  unit: String!
}

union FieldDetailsUnion =
    IntFieldConfig
  | DecimalFieldConfig
  | StringFieldConfig
  | BoolFieldConfig
  | StaticChoiceFieldConfig
  | CollapsibleContainerFieldConfig
  | StaticNumberFieldConfig

type TranslationConfig {
  helpTextName: String!
  label: String
}

type TriggerParam {
  name: String!
  value: String!
}

enum TriggerAction {
  CHANGE_NAME
  SET_VISIBILITY
}

type Trigger {
  action: TriggerAction!
  targetTypeId: String!
  params: [TriggerParam!]!
}

type NodeMetaConfig {
  isVisible: Boolean
}

type NodeConfig {
  fieldDetails: FieldDetailsUnion
  valueValidator: JsonSchema
  triggers: [Trigger]!
  translations: TranslationConfig!
  meta: NodeMetaConfig
}

type IntFieldValue {
  integer: Int!
}

type DecimalFieldValue {
  numeric: Float!
}

type StringFieldValue {
  text: String!
}

type ReferenceId {
  uuid: String!
}


type BoolFieldValue {
  enabled: Boolean!
}

union FieldValue = IntFieldValue
  | DecimalFieldValue
  | StringFieldValue
  | BoolFieldValue
  | ReferenceId

input IntFieldConfigInput {
  validator: JsonSchema!
}

input DecimalFieldConfigInput {
  validator: JsonSchema!
  precision: Int!
}

input StringFieldConfigInput {
  validator: JsonSchema!
  transforms: [String!]!
}

input BoolFieldConfigInput {
  validator: JsonSchema!
}

input StaticChoiceOptionInput {
  id: String!
  label: String!
  helpText: String!
}

input StaticChoiceFieldConfigInput {
  validator: JsonSchema!
  options: [StaticChoiceOptionInput!]!
}

input CollapsibleContainerFieldConfigInput {
  isCollapsible: Boolean!
}

input StaticNumberFieldConfigInput {
  passToTranslation: Boolean!
  precision: Int!
  unit: String!
}

enum FieldDetailsType {
  INT_FIELD_CONFIG
  DECIMAL_FIELD_CONFIG
  STRING_FIELD_CONFIG
  BOOL_FIELD_CONFIG
  STATIC_CHOICE_FIELD_CONFIG
  COLLAPSIBLE_CONTAINER_FIELD_CONFIG
  STATIC_NUMBER_FIELD_CONFIG
}

input FieldDetailsUnionInput {
  kind: FieldDetailsType!
  int: IntFieldConfigInput
  decimal: DecimalFieldConfigInput
  string: StringFieldConfigInput
  bool: BoolFieldConfigInput
  staticChoice: StaticChoiceFieldConfigInput
  collapsibleContainer: CollapsibleContainerFieldConfigInput
  staticNumberFieldConfig: StaticNumberFieldConfigInput
}

input NodeConfigInput {
  fieldDetails: FieldDetailsUnionInput
  valueValidator: JsonSchema
}

input IntFieldValueInput {
  integer: Int!
}

input DecimalFieldValueInput {
  numeric: Float!
}

input StringFieldValueInput {
  text: String!
}

input BoolFieldValueInput {
  enabled: Boolean!
}

enum FieldValueType {
  INT_FIELD_VALUE
  DECIMAL_FIELD_VALUE
  STRING_FIELD_VALUE
  BOOL_FIELD_VALUE
}

input FieldValueInput {
  kind: FieldValueType!
  int: IntFieldValueInput
  decimal: DecimalFieldValueInput
  string: StringFieldValueInput
  bool: BoolFieldValueInput
}

input ProjectDefinitionNodeInput {
  id: ID!
  projectDefId: String!
  name: String!
  isCollection: Boolean!
  instanciateByDefault: Boolean!
  orderIndex: Int!
  config: NodeConfigInput!
  defaultValue: FieldValueInput
  path: [String!]!
}

type ProjectDefinitionNode {
  id: ID!
  projectDefId: String!
  name: String!
  isCollection: Boolean!
  instanciateByDefault: Boolean!
  orderIndex: Int!
  config: NodeConfig!
  defaultValue: FieldValue
  path: [String!]!
  children: [ProjectDefinitionNode!]!
  translations: [Translation!]!
}

type ProjectDefinitionTreeNode {
  definition: ProjectDefinitionNode!
  children: [ProjectDefinitionTreeNode!]!
}

type ProjectDefinitionNodeTree {
  roots: [ProjectDefinitionTreeNode!]!
}

type ProjectDefinition {
  id: ID!
  name: String!
  defaultDatasheetId: String!
  defaultDatasheet: Datasheet!
  datasheetDefId: String!
  datasheetDefinition: DatasheetDefinition!
  rootSections(projectDefId: ID!): ProjectDefinitionNodeTree!
  rootSectionContainers(
    projectDefId: ID!
    rootSectionId: ID!
  ): ProjectDefinitionNodeTree!
  formContent(projectDefId: ID!, formId: ID!): ProjectDefinitionNodeTree!
}

type ProjectDefinitionEdge {
  node: ProjectDefinition!
  cursor: String!
}

type ProjectDefinitionConnection {
  edges: [ProjectDefinitionEdge!]!
  pageInfo: PageInfo!
}

type Formula {
  id: ID!
  projectDefId: String!
  attachedToTypeId: String!
  name: String!
  expression: String!
}

type FormulaEdge {
  node: Formula!
  cursor: String!
}

type FormulaConnection {
  edges: [FormulaEdge!]!
  pageInfo: PageInfo!
}

type ProjectEdge {
  node: ProjectDetails!
  cursor: String!
}

type ProjectConnection {
  edges: [ProjectEdge!]!
  pageInfo: PageInfo!
}

type ProjectNode {
  id: ID!
  projectId: String!
  typePath: [String!]!
  typeId: String!
  typeName: String!
  path: [String!]!
  value: FieldValue
  label: String
}

type ProjectDetails {
  id: ID!
  name: String!
  isStaged: Boolean
  projectDefId: String!
  projectDefinition: ProjectDefinition!
  datasheetId: String!
  datasheet: Datasheet!
  reportDefinitions: [ReportDefinition!]!
}

input ProjectDetailsInput {
  id: ID!
  name: String!
  projectDefId: String!
  datasheetId: String!
}

type ProjectNodeMetaState {
  isVisible: Boolean
  selectedChild: String
}

type ProjectNodeTreeNode {
  node: ProjectNode!
  children: [ProjectNodeTreeTypeNode!]!
}

type ProjectNodeTreeTypeNode {
  definition: ProjectDefinitionNode!
  state: ProjectNodeMetaState!
  nodes: [ProjectNodeTreeNode!]!
}

type ProjectNodeTree {
  roots: [ProjectNodeTreeTypeNode!]!
}

type AttributeBucket {
  bucketName: String!
  attributeName: String!
}

type ReportColumnDefinition {
  name: String!
  expression: String!
  isVisible: Boolean!
  unitId: String
}

type ReportDefinitionStructure {
  formulaAttribute: AttributeBucket!
  datasheetAttribute: AttributeBucket!
  columns: [ReportColumnDefinition!]!
}

type ReportDefinition {
    id: String!
    project_def_id: String!
    name: String!
    structure: ReportDefinitionStructure!
}

type ReportRow {
    projectId: ID!
    reportDefId: ID!
    nodeId: ID!
    formulaId: ID!
    orderIndex: Int!
    datasheetId: String!
    elementId: String!
    childReferenceId: String!
    columns: [FieldValue]!
}

type ReportStage {
  label: String
  summary: FieldValue
  rows: [ReportRow!]!
}

type Report {
  stages: [ReportStage!]!
  creationDateUtc: String
}

type Translation {
  id: ID!
  ressourceId: String!
  locale: String!
  scope: String!
  name: String!
  value: String!
}

type TranslationEdge {
  node: Translation!
  cursor: String!
}

type TranslationConnection {
  edges: [TranslationEdge!]!
  pageInfo: PageInfo!
}

type PageInfo {
  hasNextPage: Boolean!
  endCursor: String!
  totalCount: Int!
}

type Query {
  findDatasheet(id: ID!): Datasheet!
  findDatasheets(
    query: String!
    first: Int!
    after: String
  ): DatasheetConnection!
  findDatasheetDefinitions(
    query: String!
    first: Int!
    after: String
  ): DatasheetDefinitionConnection!
  findDatasheetDefinition(datasheetDefinitionId: ID!): DatasheetDefinition!
  findDatasheetDefinitionElements(
    datasheetDefinitionId: ID!
    first: Int!
    after: String
  ): DatasheetDefinitionElementConnection!
  queryDatasheetDefinitionElements(
    datasheetDefinitionId: ID!
    query: String!
    first: Int!
    after: String
  ): DatasheetDefinitionElementConnection!
  findProjectDefinition(id: ID!): ProjectDefinition!
  findProjectDefinitionRootSections(
    projectDefId: ID!
  ): ProjectDefinitionNodeTree!
  findProjectDefinitionRootSectionContainers(
    projectDefId: ID!
    rootSectionId: ID!
  ): ProjectDefinitionNodeTree!
  findProjectDefinitionFormContent(
    projectDefId: ID!
    formId: ID!
  ): ProjectDefinitionNodeTree!
  findProjectDefinitionNode(projectDefId: ID!, id: ID!): ProjectDefinitionNode!
  findRessourceTranslation(
    ressourceId: ID!
    language: String!
  ): TranslationConnection!
  findProjectDefintions(
    query: String!
    first: Int!
    after: String
  ): ProjectDefinitionConnection!
  findProjectRootSections(projectId: ID!): ProjectNodeTree!
  findProjectRootSectionContainers(
    projectId: ID!
    rootSectionId: ID!
  ): ProjectNodeTree!
  findProjectFormContent(projectId: ID!, formId: ID!): ProjectNodeTree!
  findProjects(query: String!, first: Int!, after: String): ProjectConnection!
  findProjectDetails(id: ID!): ProjectDetails!
  findProjectDefinitionFormulas(
    projectDefId: ID!
    query: String!
    first: Int!
    after: String
  ): FormulaConnection!
  findReportDefinitions(projectDefId: ID!): [ReportDefinition!]!
  findReportDefinition(reportDefinitionId: ID!): ReportDefinition!
  findProjectReport(projectId: ID!, reportDefinitionId: ID!): Report!
}

input TranslationInput {
  ressourceId: String!
  scope: String!
  locale: String!
  name: String!
  value: String!
}

input TranslationUpdateInput {
  id: ID!
  ressourceId: String!
  scope: String!
  locale: String!
  name: String!
  value: String!
}

input FieldUpdateInput {
    nodeId: ID!
    value: FieldValueInput!
}

input ProjectNodeCollectionTargetInput {
    parentNodeId: String
    collectionTypeId: String!
}

input DatasheetInput {
  name: String! 
  datasheetDefinitionId: String!
  fromDatasheetId: String
}

type Mutation {
  addTranslations(translations: [TranslationInput!]!): [Translation!]!
  updateTranslations(translations: [TranslationUpdateInput!]!): [Translation!]!
  addProjectDefinitionNode(
    node: ProjectDefinitionNodeInput!
  ): ProjectDefinitionNode!
  updateProjectField(
    projectId: ID!
    nodeId: ID!
    value: FieldValueInput!
  ): ProjectNode!
  updateProjectFields(
    projectId: ID!
    updates: [FieldUpdateInput!]!
  ): [ProjectNode]!
  cloneProjectCollection(projectId: ID!, collectionNodeId: ID!): [ProjectNode]!
  addProjectCollectionItem(projectId: ID!, collectionTarget: ProjectNodeCollectionTargetInput!): [ProjectNode]!
  createProject(projectDetails: ProjectDetailsInput): ProjectDetails!
  createDatasheet(datasheet: DatasheetInput): Datasheet!
}

schema {
  query: Query
  mutation: Mutation
}
